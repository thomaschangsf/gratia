// https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html
// https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-rescore.html
// GET /ebay-n/listing/_search
{
  "fields": [
    "title"
  ],
  "size": 100,
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "attr_ner_keys": "type:shoes"
          }
        }
      ]
    }
  },
  "rescore": {
    "window_size": 100,
    "query": {
      "rescore_query": {
        "function_score": {
          "script_score": {
            "params": {
              "query_v": [
                -0.007235,
                -0.026161,
                0.0004,
                -0.00712,
                0.024956,
                -0.009961,
                0.021143,
                0.015913,
                0.047521,
                0.018495,
                0.004962,
                0.00048,
                -0.019692,
                0.008511,
                0.004495,
                0.006559,
                -0.016968,
                -0.003801,
                0.014724,
                -0.055395,
                -0.002462,
                -0.00601,
                0.011695,
                -0.021789,
                0.02809,
                0.029516,
                -0.008454,
                0.003459,
                0.024865,
                0.026195,
                0.007061,
                -0.024487,
                0.044375,
                0.009706,
                0.012557,
                0.020792,
                0.00915,
                -0.010775,
                -0.002585,
                -0.00087,
                0.020256,
                0.015382,
                0.02562,
                -0.028375,
                0.01109,
                0.000329,
                0.022409,
                -0.003699,
                0.026834,
                -0.025203,
                0.002082,
                0.01651,
                0.033535,
                -0.010495,
                -0.018031,
                0.015747,
                -0.048079,
                -0.009149,
                -0.001487,
                0.029732,
                -0.010224,
                -0.003824,
                -0.020777,
                -0.03287,
                0.014352,
                0.020612,
                -0.008248,
                0.040769,
                0.023218,
                0.009127,
                0.042934,
                -0.007123,
                0.012944,
                0.005421,
                -0.005146,
                -0.025839,
                -0.02082,
                -0.015576,
                0.007726,
                0.010037,
                -0.002311,
                0.017606,
                0.00006,
                0.001446,
                0.013628,
                0.001643,
                -0.010055,
                0.031318,
                -0.002689,
                0.025411,
                0.006558,
                -0.028383,
                -0.018797,
                -0.00592,
                0.033874,
                0.009065,
                0.010803,
                0.031395,
                -0.000772,
                0.007832,
                -0.026855,
                -0.011692,
                -0.013434,
                0.022571,
                0.006535,
                0.012591,
                0.036012,
                -0.032021,
                -0.006027,
                0.015756,
                -0.025611,
                -0.001864,
                0.023085,
                -0.00174,
                0.016103,
                0.001852,
                0.041194,
                -0.01143,
                -0.002776,
                -0.023056,
                0.002344,
                0.015991,
                0.007487,
                -0.012632,
                0.00887,
                0.003972,
                -0.009209,
                -0.008543,
                -0.029041,
                0.000753,
                0.004676,
                -0.002223,
                -0.00464,
                -0.010995,
                0.018492,
                0.001499,
                -0.010876,
                0.020316,
                -0.031843,
                0.030932,
                0.035214,
                -0.017071,
                -0.028319,
                0.043,
                -0.022444,
                -0.028154,
                -0.007319,
                0.016072,
                -0.024598,
                -0.039564,
                -0.012373,
                -0.010211,
                0.005602,
                0.006467,
                0.001283,
                0.010273,
                -0.025477,
                0.003312,
                0.028345,
                -0.033824,
                -0.015559,
                -0.032486,
                0.000308,
                -0.013477,
                -0.008307,
                -0.013673,
                -0.002616,
                0.037115,
                0.009246,
                0.028502,
                -0.010847,
                0.039915,
                -0.009627,
                0.006002,
                -0.008898,
                0.00139,
                0.000127,
                -0.001439,
                0.001992,
                -0.001804,
                0.024567,
                0.022248,
                -0.002269,
                -0.017858,
                0.003357,
                0.000271,
                0.021338,
                0.029128,
                -0.024183,
                0.005706,
                0.007559,
                -0.021041,
                -0.009313,
                0.000053,
                0.01144,
                -0.019598,
                0.020201,
                -0.022527,
                0.021212,
                -0.02856
              ]
            },
            "script": "sumQ = query_v.collect{x -> x*x}.sum(); sumL = _source.semantic_v.collect{x -> x*x}.sum(); sumQL = [_source.semantic_v, query_v].transpose().collect{ xx, yy -> xx * yy }.sum(); return sumQL/Math.sqrt(sumQ*sumL)"
          }
        }
      },
      "query_weight": 0.7,
      "rescore_query_weight": 2.0
    }
  }
}